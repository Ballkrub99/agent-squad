---
title: Classifier Testing 
description: How to test classification and agent selection in the Multi-Agent Orchestrator
---

Testing your Multi-Agent Orchestrator's classifier ensures queries are being routed to the correct agents. Here's how to set up and run classifier tests.

## Basic Setup

1. Create a test cases file named `test_cases.txt`. For simple queries, use the format `TEST: query || expected-agent`:

```plaintext
TEST: How much does AWS Lambda cost? || billing-agent
TEST: How do I set up an S3 bucket? || tech-support-agent
TEST: My account is locked || security-agent
```

For queries with conversation history, number the history lines and end with the test case:
```plaintext
1: How do I set up an S3 bucket?
2: [tech-support-agent] First, go to the S3 console...
TEST: What's the next step? || tech-support-agent

1: How do I set up an S3 bucket?
2: [tech-support-agent] First, go to the S3 console...
TEST: How much will that cost? || billing-agent
```

2. Create a test script:

import { Tabs, TabItem } from '@astrojs/starlight/components';


<Tabs syncKey="runtime">
  <TabItem label="TypeScript" icon="seti:typescript" color="blue">
    ```typescript
    import { BedrockClassifier } from "multi-agent-orchestrator";
    import fs from 'fs/promises';

    async function parseTestFile(filePath: string) {
      const content = await fs.readFile(filePath, 'utf8');
      const lines = content.split('\n');
      const testCases = [];
      let currentHistory = [];
      
      for (const line of lines) {
        const trimmed = line.trim();
        if (!trimmed) {
          // Empty line resets conversation
          currentHistory = [];
          continue;
        }

        if (trimmed.startsWith('TEST:')) {
          // Parse test case
          const testPart = trimmed.substring(5).trim();
          const [input, expectedAgent] = testPart.split('||').map(s => s.trim());
          testCases.push({
            input,
            expectedAgent,
            history: [...currentHistory]
          });
        } else if (trimmed.match(/^\d+:/)) {
          // Parse history line
          const messagePart = trimmed.substring(trimmed.indexOf(':') + 1).trim();
          currentHistory.push({
            role: messagePart.includes('[') ? 'assistant' : 'user',
            content: [{ text: messagePart }]
          });
        }
      }
      
      return testCases;
    }

    async function runTests() {
      const testCases = await parseTestFile('test_cases.txt');
      const classifier = new BedrockClassifier();
      let passed = 0;
      let failed = 0;
      
      console.log('\nRunning classifier tests...\n');
      console.log('Input'.padEnd(40), '| Expected'.padEnd(15), '| Got'.padEnd(15), '| Result');
      console.log('-'.repeat(80));

      for (const test of testCases) {
        const result = await classifier.classify(test.input, test.history);
        const selectedAgent = result.selectedAgent?.id || 'none';
        const matched = selectedAgent === test.expectedAgent;
        
        console.log(
          test.input.substring(0, 37).padEnd(40),
          '|', test.expectedAgent.padEnd(14),
          '|', selectedAgent.padEnd(14),
          '|', matched ? '✓' : '✗'
        );

        matched ? passed++ : failed++;
      }

      console.log('\nResults:');
      console.log(`Passed: ${passed}`);
      console.log(`Failed: ${failed}`);
      console.log(`Success Rate: ${(passed / (passed + failed) * 100).toFixed(1)}%\n`);
    }

    runTests().catch(console.error);
    ```
  </TabItem>
  <TabItem label="Python" icon="seti:python">
    ```python
    from multi_agent_orchestrator import BedrockClassifier
    import asyncio

    def parse_test_file(file_path: str):
        with open(file_path) as f:
            lines = f.readlines()
            
        test_cases = []
        current_history = []
        
        for line in lines:
            trimmed = line.strip()
            if not trimmed:
                # Empty line resets conversation
                current_history = []
                continue
                
            if trimmed.startswith('TEST:'):
                # Parse test case
                test_part = trimmed[5:].strip()
                input_text, expected_agent = [s.strip() for s in test_part.split('||')]
                test_cases.append({
                    'input': input_text,
                    'expected_agent': expected_agent,
                    'history': current_history.copy()
                })
            elif trimmed[0].isdigit() and ':' in trimmed:
                # Parse history line
                message = trimmed[trimmed.index(':') + 1:].strip()
                current_history.append({
                    'role': 'assistant' if '[' in message else 'user',
                    'content': [{'text': message}]
                })
                
        return test_cases

    async def run_tests():
        test_cases = parse_test_file('test_cases.txt')
        classifier = BedrockClassifier()
        passed = failed = 0
        
        print('\nRunning classifier tests...\n')
        print(f"{'Input':40} | {'Expected':14} | {'Got':14} | Result")
        print('-' * 80)

        for test in test_cases:
            result = await classifier.classify(test['input'], test['history'])
            selected_agent = result.selected_agent.id if result.selected_agent else 'none'
            matched = selected_agent == test['expected_agent']
            
            print(f"{test['input'][:37]:40} | {test['expected_agent']:14} | {selected_agent:14} | {'✓' if matched else '✗'}")
            
            if matched:
                passed += 1
            else:
                failed += 1

        print('\nResults:')
        print(f"Passed: {passed}")
        print(f"Failed: {failed}")
        print(f"Success Rate: {passed / (passed + failed) * 100:.1f}%\n")

    if __name__ == '__main__':
        asyncio.run(run_tests())
    ```
  </TabItem>
</Tabs>

## Test Examples

### Basic Tests
```plaintext
TEST: How much does AWS Lambda cost? || billing-agent
TEST: How do I set up an S3 bucket? || tech-support-agent
TEST: My account is locked || security-agent
```

### Context-Aware Tests
```plaintext
1: How do I set up an S3 bucket?
2: [tech-support-agent] First, go to the S3 console...
TEST: What's the next step? || tech-support-agent

1: Tell me about AWS Lambda
2: [tech-support-agent] AWS Lambda is a serverless compute service...
TEST: How much does it cost to run? || billing-agent
```

### Edge Cases
```plaintext
TEST: yes || last-agent
TEST: help || tech-support-agent
TEST: ... || tech-support-agent
```

### Multi-Intent Queries
```plaintext
TEST: I need help with S3 setup and want to know the cost || tech-support-agent
TEST: My account is locked and I can't access my EC2 instances || security-agent
TEST: Can you help me optimize costs and fix permissions? || billing-agent
```

## Best Practices

1. **Test Coverage**: Include a variety of queries covering all agent domains
2. **Context Testing**: Test both standalone queries and follow-up messages with history
3. **Edge Cases**: Include ambiguous queries and transitions between agents
4. **Regular Updates**: Add new test cases when you discover misrouted queries in production

## Example Test Output
```
Running classifier tests...

Input                                    | Expected      | Got           | Result
--------------------------------------------------------------------------------
How much does AWS Lambda cost?          | billing-agent | billing-agent | ✓
How do I set up an S3 bucket?          | tech-support  | tech-support  | ✓
What's the next step?                   | tech-support  | tech-support  | ✓

Results:
Passed: 3
Failed: 0
Success Rate: 100.0%
```